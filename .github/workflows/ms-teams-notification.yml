name: 1. Send MS Teams Notification ðŸ‘¥
on: 
  workflow_dispatch:
  push:
    branches:    
      - main

env:
  ARTIFACT_NAME: my-apk
  ARTIFACT_DOWNLOAD_LINK: https://link-to-artifact.com

jobs:
  teams-notify:
    runs-on: ubuntu-latest
    steps:
    - name: Checkout code
      uses: actions/checkout@v2
    - name: Generate artifact
      run: |
        # Replace this command with the command to generate your artifact
        echo "Hello, World!" > artifact.txt
    - name: upload_artifacts
      uses: actions/upload-artifact@v2
      with:
        name: ${{ env.ARTIFACT_NAME }}
        path: artifact.txt

    - name: Set download link env var
      run: echo "https://github.com/${{ github.repository }}/actions/artifacts/download/${{ env.ARTIFACT_NAME }}" >>  ${{ ARTIFACT_DOWNLOAD_LINK }}
    
    - name: test download link
      run: echo url  ${{ ARTIFACT_DOWNLOAD_LINK }}

    - name: test steps link
      run: echo ${{ steps.upload_artifacts.outputs.url }}

    - name: Notify MS Teams
      run: |
        curl -X POST -H "Content-Type: application/json" -d '{
          "@type": "MessageCard",
          "@context": "https://schema.org/extensions",
          "summary": "Build and Test complete",
          "themeColor": "0076D7",
          "title": "Build and Test complete",
          "text": "The build and test for the code has completed.
          The artifact can be found at ${{ ARTIFACT_DOWNLOAD_LINK }}",
          "potentialAction": [
            {
              "@type": "OpenUri",
              "name": "View artifact",
              "targets": [
                { "os": "default", "uri": ${{ ARTIFACT_DOWNLOAD_LINK }} }
              ]
            }
          ]
        }' ${{ secrets.MS_TEAMS_WEBHOOK_URL }}

      #url: ${{ steps.download_artifact.outputs.url }}
                
