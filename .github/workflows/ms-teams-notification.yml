name: 1. Send MS Teams Notification ðŸ‘¥
on: 
  workflow_dispatch:
  push:
    branches:    
      - main

jobs:
  notify-teams:
    runs-on: ubuntu-latest
    steps:
    - name: Create dummy artifact
      run: echo "This is a dummy artifact" > dummy.txt
      env:
        dummy_file: dummy.txt

    

   # - name: Send MS Teams notification
      # uses: peter-evans/create-or-update-ms-teams-card@v3
      # with:
      #   webhook-url: ${{ secrets.MS_TEAMS_WEBHOOK_URL }}
      #   title: "New artifact available"
      #   text: "A new artifact has been created and is available for download."
      #   attachments:
      #     - title: "Download artifact"
      #       url: ${{ steps.download_artifact.outputs.url }}
      #   sections: |
      #     - activityTitle: "Artifact details"
      #       activitySubtitle: "Dummy text file"
      #       activityText: "This is a dummy artifact that was created as an artifact."
      #       activityImage: "https://dummyimage.com/100x100/000/fff"
      #       facts:
      #         - name: "Commit"
      #           value: "${{ github.sha }}"
      #         - name: "Author"
      #           value: "${{ github.actor }}"
                
    - name: Download artifact
      id: download_artifact
      uses: actions/download-artifact@v2
      with:
        name: ${{ env.dummy_file }}
    
    - name: Notify MS Teams
      run: |
        curl -X POST -H "Content-Type: application/json" -d '{
          "@type": "MessageCard",
          "@context": "https://schema.org/extensions",
          "summary": "A new build is available",
          "themeColor": "0076D7",
          "title": "New APK",
          "text": "The build and test for the code has completed. The artifact can be found at $artifact_link",
          "potentialAction": [
            {
              "@type": "OpenUri",
              "name": "View artifact",
              "targets": [
                { "os": "default", "uri": ${{ steps.download_artifact.outputs.url }} }
              ]
            }
          ]
        }' ${{ secrets.MS_TEAMS_WEBHOOK_URL }}